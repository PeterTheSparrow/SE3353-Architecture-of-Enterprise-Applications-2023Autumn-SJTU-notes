# 第23讲 GraphQL

2023.12.01

> 总要在雨天 逃避某段从前
> 但雨点偏偏促使这样遇见
> 总要在雨天 人便挂念从前
> 在痛哭告别后从没再见
> ——《分手总要在雨天》 张学友


前面我们说的客户端和服务端的交互方式：
1. 大二的时候我们只知道发http请求：get，post，put，delete，充分利用这些方法，产生restful的交互性，实现增删改查（但是没有复杂的交互逻辑，我如果想要一个很复杂的逻辑，就不好说了）。
2. 后来我们又看到了websocket。

> recall：什么是RESTful API？
>
> RESTful API（Representational State Transfer API）是一种设计风格，用于构建网络服务和应用程序之间的通信。它基于 REST 架构原则，这些原则提供了一组规范和约定，使得系统能够在分布式环境中更加灵活、可扩展和易于维护。
以下是 RESTful API 的一些关键特征和原则：
>1. **资源（Resources）：** 在 REST 中，所有的事物都被视为资源。每个资源都有一个唯一的标识符（通常是 URI）。
>2. **表现层（Representation）：** 资源的表现层定义了如何表示和传输资源的状态。通常，这可以是 JSON、XML 或其他格式。
>3. **状态无关（Stateless）：** 每个请求从客户端到服务器都必须包含所有信息，服务器不应存储客户端的状态。这使得系统更容易扩展，因为不依赖于特定的会话状态。
>4. **统一接口（Uniform Interface）：** 统一接口是 RESTful API 的核心。它包括以下几个原则：
    - **标识资源：** 使用唯一的 URI 标识每个资源。
    - **通过资源操作：** 使用标准化的 HTTP 方法（GET、POST、PUT、DELETE）对资源执行操作。
    - **自描述消息：** 通过资源的表现层传递的消息应该包含足够的信息，使客户端能够理解并处理资源。
>5. **无状态通信（Stateless Communication）：** 每个请求从客户端到服务器都必须包含所有必要的信息，服务器不应存储客户端的状态。
RESTful API 被广泛用于构建 Web 服务、移动应用后端和其他分布式系统，因为它提供了一种简单而灵活的方式来设计和管理 API。在使用 RESTful API 时，客户端可以通过简单的 HTTP 请求与服务器进行通信，并使用资源标识符来操作和获取数据。


GraphQL本身是一种查询语言，我们这里运用的是Http协议，request body里面的内容是GraphQL的查询语句。服务器端处理之后，返回给你一个带着查询结果的response。

查询和返回的结果全部都是json格式的数据。

### 区别：

1. **查询语言和端点数量：**
   - **GraphQL：** 使用单一端点，客户端可以精确指定所需数据，而无需多次请求不同的端点。GraphQL 使用一种强大的查询语言，允许客户端请求自己需要的字段。
   - **RESTful API：** 通常使用多个端点，每个端点代表一个资源或一组相关资源。客户端需要根据 RESTful API 的设计来请求不同的端点，每个端点返回预定义的数据结构。

2. **数据获取方式：**
   - **GraphQL：** 客户端可以按需获取需要的数据，而不会获取过多或过少的数据。客户端决定所需数据的结构。
   - **RESTful API：** 服务器端决定返回的数据结构，客户端需要根据服务器端提供的资源路径获取数据。

3. **版本管理：**
   - **GraphQL：** 由于客户端可以精确指定所需数据，因此不需要对 API 版本进行严格管理。新增或修改字段不会影响现有客户端。
   - **RESTful API：** 如果对资源进行了修改，可能需要增加 API 版本或通过其他方式进行版本管理，以确保对现有客户端的兼容性。

4. **实时数据：**
   - **GraphQL：** 支持实时数据的推送，可以通过订阅机制实现。
   - **RESTful API：** 通常需要通过轮询或使用 WebSocket 等机制来实现实时性。

### 联系：

1. **HTTP 协议：** GraphQL 和 RESTful API 都基于 HTTP 协议，可以使用相同的底层传输机制。

2. **资源：** 两者都处理资源，但 RESTful API 以资源为中心，每个资源有一个唯一的 URI，而 GraphQL 允许客户端根据需要组合资源。

3. **用途：** 根据具体的需求和团队偏好，选择 GraphQL 或 RESTful API。RESTful API 在很多项目中仍然是非常流行和有效的选择，而 GraphQL 提供了更灵活的数据获取方式。

总体来说，选择 GraphQL 还是 RESTful API 取决于项目的特定需求和团队的背景，每种架构风格都有其适用的场景。
