# 第20讲 DataLake 数据湖

2023.11.22

> 应该早已没期待
应该心死为何仍未放开
应该不要回来任你伤害
恋什么爱 你精彩 我悲哀
>——《我应该》 张学友

## 1. Data Warehouse 数据仓库

数据仓库：
- 多元的数据如何融合处理？数据仓库：把很多来源的数据加载之后，把他们安装同一个方式存储。
- 比如交大的数据、复旦、同济的数据，可能分别有10、11、12个字段的数据，需要把这些数据“抽取、转换、存储”，通常来说把不同的文件转存储到Parquet/RC File的文件格式
- RC File的文件：把原始的关系抽取某一列或者几列、甚至把整个表存储起来。同时文件最前面还有有一些元数据表达的行号是哪几行、或者是否有压缩，压缩后key长度。然后这些文件被建成HDFS的块。
- Parquet：类似RC File。
- 存在的问题：需要**ETL（抽取、转换、存储）然后写入到Parquet的中间文件格式，这个的代价是很大的**。而这些文件在之后如果直接做SQL的时候效率很低。所以最终还是要转到SQL的数据库中（直接对数据库处理）那我们就想：如果数据来了，我们可不可以先把数据按照原始的格式存储，当我真正需要的时候，再把数据导入进来。所以这就是数据湖。

## 2. Data Lake 数据湖

数据湖：
- 以**自然/原始格式存储数据**的系统或存储库，通常是对象blob或文件
- 数据湖通常是一个单一的数据存储，包括源系统数据、传感器数据、社交数据等的原始副本，以及用于报告、可视化、高级分析和机器学习等任务的转换数据。
- 数据湖可以包括来自关系数据库的结构化数据（行和列）、半结构化数据（CSV、日志、XML、JSON）、非结构化数据（电子邮件、文档、pdf）和二进制数据（图像、音频、视频）。数据湖可以建立在“本地”（在组织的数据中心内）或“云中”（使用亚马逊、微软、甲骨文云或谷歌等供应商的云服务）。

1. 在必要的时候会通过ETL的方法，把数据导入到数据仓库的里面
2. 数据湖要解决的问题就是：面临大量的数据要导入的时候怎么把原始数据快速接受下来

## 3. Data Lake vs Data Warehouse

数据湖和数据仓库的四个不同点：
| | Data Lake | Data Warehouse |
| --- | --- | --- |
| Data Structure| Raw | Processed |
| Propose of Data | Not yet defined | Currently in use |
| Users | Data Scientists：针对原始数据进行处理 | Business Professionals：主要针对商业金融的分析、统计 |
| Accessibility | Highly accessible and quick to update：因为不需要去做etl这样的动作 | More complicated and costly to make changes：可以理解为主要是数据的一次导入，以后只是做分析的 |

| 特点 | 数据仓库 | 数据湖 |
| --- | --- | --- |
| 数据 | 关系数据 | 各种数据（因为它是直接存储的原始数据：结构化半结构化等等都可以）|
| schema 模式| 比较严格的模式，数据在读取的时候或者写入的时候做一个校验（schema-on-write或者read）| schema-on-read（只有在数据分析的时候，也就是从读走数据的时候校验数据的模式是否合法，因为它是直接存储的原始数据，存储的时候不校验）|
| 性能 | 本地存储的时候非常快 | 用低成本的存储把大量的数据存储进来，当搜索的时候可能比较慢 |
| 数据质量 | schema-on-write，过滤了不合规定的数据 | 因为所有数据直接接受，质量无保证 |

- 湖仓一体：不管是谁要来查数据，都到底层去抓数据，如果是关系型的就去关系型的找数据，非关系型的就到非关系型的去找就好了，不严格区分数据湖和数据仓库。